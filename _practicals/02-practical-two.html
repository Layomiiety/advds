---
title: "Practical 2"
venue: "Intel Lab, William Gates Building"
abstract: "<p>In this practical session we look at the second aspect of
the Fynesse data science process, <em>assess</em>. In particular, we are
going to download data from OpenStreetMap and verify its quality and
utility.</p>"
author:
- given: Neil D.
  family: Lawrence
  url: http://inverseprobability.com
  institute: University of Cambridge
  twitter: lawrennd
  gscholar: r3SJcvoAAAAJ
  orcid: 
edit_url: https://github.com/lawrennd/talks/edit/gh-pages/_advds/practical-two.md
date: 2023-11-02
published: 2023-11-02
week: 0
featured_image: assets/images/practical-two.png
transition: None
ipynb: 02-practical-two.ipynb
layout: practical
categories:
- notes
---



<!-- Do not edit this file locally. -->
<!---->
<!-- Do not edit this file locally. -->
<!-- Do not edit this file locally. -->
<!-- The last names to be defined. Should be defined entirely in terms of macros from above-->
<!--

-->
<p>Check Session for this Practical is 7th November 2023</p>
<h2 id="revert-matplotlib-version">Revert Matplotlib Version</h2>
<p>Revert <code>matplotlib</code> version on Google Colab due to bug
mentioned <a
href="https://github.com/facebook/prophet/issues/1691">here</a>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install osmx</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip uninstall <span class="op">--</span>yes matplotlib</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install matplotlib<span class="op">==</span><span class="fl">3.1.3</span></span></code></pre></div>
<h2 id="setup">Setup</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_notebooks/includes/notebook-setup.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_notebooks/includes/notebook-setup.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<!--setupplotcode{import seaborn as sns
sns.set_style('darkgrid')
sns.set_context('paper')
sns.set_palette('colorblind')}-->
<h2 id="notutils">notutils</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_software/includes/notutils-software.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_software/includes/notutils-software.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>This small package is a helper package for various notebook utilities
used below.</p>
<p>The software can be installed using</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install notutils</span></code></pre></div>
<p>from the command prompt where you can access your python
installation.</p>
<p>The code is also available on GitHub: <a
href="https://github.com/lawrennd/notutils"
class="uri">https://github.com/lawrennd/notutils</a></p>
<p>Once <code>notutils</code> is installed, it can be imported in the
usual manner.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> notutils</span></code></pre></div>
<h2 id="pods">pods</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_software/includes/pods-software.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_software/includes/pods-software.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>In Sheffield we created a suite of software tools for ‘Open Data
Science’. Open data science is an approach to sharing code, models and
data that should make it easier for companies, health professionals and
scientists to gain access to data science techniques.</p>
<p>You can also check this blog post on <a
href="http://inverseprobability.com/2014/07/01/open-data-science">Open
Data Science</a>.</p>
<p>The software can be installed using</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install pods</span></code></pre></div>
<p>from the command prompt where you can access your python
installation.</p>
<p>The code is also available on GitHub: <a
href="https://github.com/lawrennd/ods"
class="uri">https://github.com/lawrennd/ods</a></p>
<p>Once <code>pods</code> is installed, it can be imported in the usual
manner.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pods</span></code></pre></div>
<h2 id="mlai">mlai</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_software/includes/mlai-software.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_software/includes/mlai-software.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>The <code>mlai</code> software is a suite of helper functions for
teaching and demonstrating machine learning algorithms. It was first
used in the Machine Learning and Adaptive Intelligence course in
Sheffield in 2013.</p>
<p>The software can be installed using</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install mlai</span></code></pre></div>
<p>from the command prompt where you can access your python
installation.</p>
<p>The code is also available on GitHub: <a
href="https://github.com/lawrennd/mlai"
class="uri">https://github.com/lawrennd/mlai</a></p>
<p>Once <code>mlai</code> is installed, it can be imported in the usual
manner.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mlai</span></code></pre></div>
<h2 id="mapping-data">Mapping Data</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_maps/includes/mapping-intro.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_maps/includes/mapping-intro.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>Many of the questions we ask in data science are about how we live,
who we are and how we might live better. So it is no surprise that an
important source of information for data science comes from <em>mapping
data</em>.</p>
<p>Questions about how best to make deliveries, where to locate
facilities, national disease susceptibility, how to get to work, where
to go for a walk, disaster response<a href="#fn1" class="footnote-ref"
id="fnref1" role="doc-noteref"><sup>1</sup></a> and a myriad of other
applications.</p>
<p>The wider field of geospatial data analysis is also vital for
monitoring our environment and human activity<a href="#fn2"
class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> on
our globe.</p>
<p>With all of this in mind, mapping data seems an appropriate domain in
which to explore how we can assess a data set for use in a particular
data science domain.</p>
<p>In this practical session, you will learn how to download data from
OpenStreetMap, in particular we will focus on <em>points of
interest</em> in OpenStreetMap. We will explore the utility of points of
interest as a way of adding features into our models. We will introduce
the notion of a basis function. In spatial data the basis functions we
use will become features on the landscape.</p>
<p>Before we start, we’ll introduce a few other ideas to inspire how you
think about the data you collage. In particular, a tool for creating
“play data” and we’ll introduce you to the interactive funcitonality of
the notebook.</p>
<h2 id="playing-with-data-draw">Playing with Data Draw</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_data-science/includes/drawdata-play.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_data-science/includes/drawdata-play.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>This section is inspired by <a href="https://blog.ouseful.info/">a
blog post by Tony Hirst</a><a href="#fn3" class="footnote-ref"
id="fnref3" role="doc-noteref"><sup>3</sup></a> who talks about the
importance of <em>play</em>.</p>
<blockquote>
<p>One of the most powerful learning techniques I know that works for me
is play, the freedom to explore an idea or concept or principle in an
open-ended, personally directed way, trying things out, test them,
making up “what if?” scenarios, and so on.</p>
<p>Playing takes time of course, and the way we construst courses means
that we donlt give students time to play, preferring to overload them
with lots of stuff read, presumably on the basis that stuff = value.</p>
<p>If I were to produce a 5 hour chunk of learning material that was
little more three or four pages of text, defining various bits of
playful activity, I suspect that questions would be asked on the basis
that 5 hours of teaching should include lots more words… I also suspect
that the majority of students would not know how to play consructively
within the prescribed bounds for that length of time.</p>
<p>Tony Hirst <span class="citation"
data-cites="Hirst-supporting21">(Hirst, 2021)</span></p>
</blockquote>
<p>OK, we’ll try and keep this session below five hours, but Tony’s
instinct is quite correct here. You will learn more from playing with
data than in any formal session. So let’s give it a try in the way Tony
suggests.</p>
<h2 id="drawdata-data">Drawdata Data</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_datasets/includes/drawdata-data.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_datasets/includes/drawdata-data.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>The <code>drawdata</code> package is made available by <a
href="https://github.com/koaning">Vincent D. Warmerdam</a> for drawing
datasets within the Jupyter notebook. You can find it on <a
href="https://github.com/koaning/drawdata">Github here</a>. See also <a
href="https://calmcode.io/labs/drawdata.html">this page</a>.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install drawdata</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> drawdata <span class="im">import</span> draw_scatter</span></code></pre></div>
<p>Now you can draw scatter data to your heart’s content. You can select
one of the groups and draw a region which will be filled roughly with
random dots.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>draw_scatter()</span></code></pre></div>
<h3 id="on-a-local-machine">On a Local Machine</h3>
<p>If you are running this on a local machine then copy the data to the
clipboard by pressing <code>copy csv</code> and convert to a
<code>DataFrame</code> as follows.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_clipboard(sep<span class="op">=</span><span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<h3 id="on-google-colab">On Google Colab</h3>
<p>Otherwise, on Google Colab you can download the file to your local
machine, it will save as <code>data.csv</code>. Then you can upload that
data into Colab as follows.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> files</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>uploaded <span class="op">=</span> files.upload()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(io.StringIO(uploaded[<span class="st">&quot;data.csv&quot;</span>].decode(<span class="st">&quot;utf-8&quot;</span>)))</span></code></pre></div>
<h3 id="name-the-drawdata-dataframe">Name the Drawdata Dataframe</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>drawdata_data <span class="op">=</span> data</span></code></pre></div>
<h2 id="simpsons-paradox">Simpson’s Paradox</h2>
<p>We introduced <a
href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s
paradox</a> briefly in the “Review and Refresh” lab session.</p>
<h3 id="exercise-1">Exercise 1</h3>
<p>Use <code>drawdata</code> to construct a data set that exhibits
Simpson’s paradox.</p>
<p>Here’s some pandas functionality you might find useful,</p>
<pre><code>pd.DataFrame.corr?</code></pre>
<p>and</p>
<pre><code>pd.DataFrame.groupby?</code></pre>
<p>If you want to play some more, why not try and create your own
drawing of a Gorilla that gives plausible correlation values for a BMI
dataset? But don’t spend five hours on this! If you want to draw the
data with lines, you can use <code>draw_line</code> from
<code>drawdata</code> instead of <code>draw_scatter</code>.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_interact <span class="op">=</span> drawdata_data</span></code></pre></div>
<h2 id="interaction-in-jupyter-notebook">Interaction in Jupyter
Notebook</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_data-science/includes/dataframe-interact.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_data-science/includes/dataframe-interact.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>As well as providing plotting capabilities, the notebook gives us the
capability to interact with python objects. We can design custom
interaces to work with the data we have.</p>
<p>Here we are inspired by a blog post from Tony Hirst <span
class="citation" data-cites="Hirst-interactive16">(Hirst,
2016)</span>.</p>
<p>The Jupyter notebook was originally introduced by the IPython
project. For that reason it’s widgets are nown as
<code>ipywidgets</code>. These widgets are one of the most powerful
features of the notebook. They allow you to create your own customised
interaction interfaces for the data.</p>
<p>The key functionality is included in the function
<code>interact</code>.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets <span class="im">as</span> widgets</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact, fixed</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span></code></pre></div>
<p>The first trick is to write a callback function. This callback
function will display the data frame as required.</p>
<p>Now we can easily create selection boxes by passing a keyword
arguments to <code>interact</code> alongside the callback function. If
the keyword arguments contain lists, then interact interprets that as a
request to form a selection box to pass to the callback function for
that keyword argument. The special interact style <code>fixed</code> is
interpreted as information that is passed directly to the function
(i.e. not user selected).</p>
<p>We’ll select column <code>z</code> to operate on and allow us to
select from the unique values in that column (which represent the
classes <code>a</code> through <code>d</code> for filtering.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>column <span class="op">=</span> <span class="st">&quot;z&quot;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="st">&quot;all&quot;</span>] <span class="op">+</span> <span class="bu">sorted</span>(data_interact[column].unique().tolist())</span></code></pre></div>
<p>Now we can create the interact.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> interact(view_df,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>             dataframe<span class="op">=</span>fixed(data_interact), </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>             column<span class="op">=</span>fixed(column),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>             item<span class="op">=</span>items)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>item_select <span class="op">=</span> widgets.Select(options<span class="op">=</span>[<span class="st">&quot;all&quot;</span>] <span class="op">+</span> <span class="bu">sorted</span>(data_interact[column].unique().tolist()))</span></code></pre></div>
<p>You can <a
href="https://ipywidgets.readthedocs.io/en/stable/examples/Widget%20List.html">read
more about the available widgets in the documentation</a>.</p>
<p>Let’s make use of the <code>IntSlider</code> widget and the
<code>Select</code> widget to limit the number of rows we display from
the data frame. To do this we first introduce a new callback
function.</p>
<p>Now we introduce a slider.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>number_slider <span class="op">=</span> widgets.IntSlider(<span class="bu">min</span><span class="op">=</span><span class="dv">0</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">15</span>, step<span class="op">=</span><span class="dv">1</span>, value<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>item_select <span class="op">=</span> widgets.Select(options<span class="op">=</span>items)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> interact(view_df2, dataframe<span class="op">=</span>fixed(data_interact),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>             column<span class="op">=</span>fixed(<span class="st">&quot;z&quot;</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>             item<span class="op">=</span>item_select,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>             number<span class="op">=</span>number_slider)</span></code></pre></div>
<h3 id="exercise-2">Exercise 2</h3>
<p>Update the interact to have a <code>FloatSlider</code> element that
filters out elements from column <code>x</code> or <code>y</code> (by
choice) if they are above a particular value.</p>
<h2 id="accessing-open-street-map">Accessing Open Street Map</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_maps/includes/open-street-map.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_maps/includes/open-street-map.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install osmnx</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> osmnx <span class="im">as</span> ox</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>We will center out download on the city of Kamplala, Uganda, which
has the following latitude and longitude.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>place_name <span class="op">=</span> <span class="st">&quot;Kampala, Uganda&quot;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">0.347596</span> <span class="co"># Kampala latitude</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="fl">32.582520</span> <span class="co"># Kampala longitude</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>placestub <span class="op">=</span> place_name.lower().replace(<span class="st">&#39; &#39;</span>, <span class="st">&#39;-&#39;</span>).replace(<span class="st">&#39;,&#39;</span>,<span class="st">&#39;&#39;</span>)</span></code></pre></div>
<p>We’ll create a bounding box which is 0.02 degrees wide, 1 degree is
around 111km (<a
href="https://en.wikipedia.org/wiki/Metre">circumference of the Earth is
around 40,000 km</a> and 40,000/360=111km).</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>box_width <span class="op">=</span> <span class="fl">0.02</span> <span class="co"># About 2.2 km</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>box_height <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>north <span class="op">=</span> latitude <span class="op">+</span> box_height<span class="op">/</span><span class="dv">2</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>south <span class="op">=</span> latitude <span class="op">-</span> box_height<span class="op">/</span><span class="dv">2</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>west <span class="op">=</span> longitude <span class="op">-</span> box_width<span class="op">/</span><span class="dv">2</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>east <span class="op">=</span> longitude <span class="op">+</span> box_width<span class="op">/</span><span class="dv">2</span></span></code></pre></div>
<p>Now we’ll download a set of points of interest from OpenStreetMap. We
can specify the points of interest we’re interested in by building a
small dictionary containing their labels as follows.</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve POIs</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>tags <span class="op">=</span> {<span class="st">&quot;amenity&quot;</span>: <span class="va">True</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;buildings&quot;</span>: <span class="va">True</span>, </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;historic&quot;</span>: <span class="va">True</span>, </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;leisure&quot;</span>: <span class="va">True</span>, </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;shop&quot;</span>: <span class="va">True</span>, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;tourism&quot;</span>: <span class="va">True</span>}</span></code></pre></div>
<p>Now we can use <code>osmx</code> to download all such points of
interest within a given bounding box.</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pois <span class="op">=</span> ox.geometries_from_bbox(north, south, east, west, tags)</span></code></pre></div>
<p>That operation can take some time, particularly as the bounding box
grows larger. Once it is complete we can check how many points of
interest we have found.</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;There are </span><span class="sc">{number}</span><span class="st"> points of interest surrounding </span><span class="sc">{placename}</span><span class="st"> latitude: </span><span class="sc">{latitude}</span><span class="st">, longitude: </span><span class="sc">{longitude}</span><span class="st">&quot;</span>.<span class="bu">format</span>(number<span class="op">=</span><span class="bu">len</span>(pois), placename<span class="op">=</span>place_name, latitude<span class="op">=</span>latitude, longitude<span class="op">=</span>longitude))</span></code></pre></div>
<p>And then we can examine their contents in more detail.</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pois.info</span></code></pre></div>
<p>We notice a few things.</p>
<ol type="1">
<li><p>Points of interest do not have a consistent OpenStreetMap
<code>element_type</code>, some are <code>node</code>, others are
<code>relation</code> and we also have <code>way</code>. You can find
out more about elements in OpenStreetMap on <a
href="https://wiki.openstreetmap.org/wiki/Elements">this wiki page</a>.
This will become important when tidying up the data for next stage
processing.</p></li>
<li><p>Many of the values are missing. In SQL we would express a missing
value as <code>NULL</code>. But in <code>pandas</code> a missing value
is expressed as not-a-number, <code>NaN</code>. This is quite a common
standard, but it is not the only standard. Sometimes data is collected
and coded with an “unreasonable” value for a missing value. For example,
someone might set missing values for heights to -999. The concept is
that this is an obviously void “height” and would trigger a human user
to check whether it’s a missing value. Of course, this is obvious to
humans, but not necessarily to a computer!</p></li>
</ol>
<p>Nodes, ways and relations in OpenStreetMap all have different
<em>keys</em> associated with them. The data is not structured in
standard database columns. Different points of interest might have
different keys present or absent. The <code>gdf</code> we recover places
these keys in its columns, but if</p>
<p>So we might be interested in the following keys.</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> [<span class="st">&quot;name&quot;</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;addr:city&quot;</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;addr:postcode&quot;</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;amenity&quot;</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;building&quot;</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;building:name&quot;</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;building:colour&quot;</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;building:material&quot;</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;historic&quot;</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;memorial&quot;</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;religion&quot;</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;tourism&quot;</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;emergency&quot;</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;leisure&quot;</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;shop&quot;</span>]</span></code></pre></div>
<p>But our downloaded <code>gdf</code> may have fewer keys.</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pois.columns.values</span></code></pre></div>
<p>We can write a short piece of code to discover which keys are missing
drom the data frame’s columns.</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> pois.columns:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(key)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>present_keys <span class="op">=</span> [key <span class="cf">for</span> key <span class="kw">in</span> keys <span class="cf">if</span> key <span class="kw">in</span> pois.columns]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>pois[present_keys]</span></code></pre></div>
<p>This gives us the relevant points of interest (part of the map). If
we’d like to see the entire street network, we can download the entire
graph from the location.</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> ox.graph_from_bbox(north, south, east, west)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve nodes and edges</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>nodes, edges <span class="op">=</span> ox.graph_to_gdfs(graph)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get place boundary related to the place name as a geodataframe</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>area <span class="op">=</span> ox.geocode_to_gdf(place_name)</span></code></pre></div>
<p>Which we can then render as follows.</p>
<div class="figure">
<div id="kampala-uganda-pois-figure" class="figure-frame">
<object class="svgplot " data="https://mlatcl.github.io/advds/./slides/diagrams//maps/kampala-uganda-pois.svg" width="70%" style=" ">
</object>
</div>
<div id="kampala-uganda-pois-magnify" class="magnify"
onclick="magnifyFigure(&#39;kampala-uganda-pois&#39;)">
<img class="img-button" src="{{ '/assets/images/Magnify_Large.svg' | relative_url }}" style="width:1.5ex">
</div>
<div id="kampala-uganda-pois-caption" class="caption-frame">
<p>Figure: Points of Interest as identified in Open Street Map.</p>
</div>
</div>
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tourist_places <span class="op">=</span> pois[pois.tourism.notnull()]</span></code></pre></div>
<div class="figure">
<div id="kampala-uganda-tourist-sites-figure" class="figure-frame">
<object class="svgplot " data="https://mlatcl.github.io/advds/./slides/diagrams//maps/kampala-uganda-tourist-sites.svg" width="70%" style=" ">
</object>
</div>
<div id="kampala-uganda-tourist-sites-magnify" class="magnify"
onclick="magnifyFigure(&#39;kampala-uganda-tourist-sites&#39;)">
<img class="img-button" src="{{ '/assets/images/Magnify_Large.svg' | relative_url }}" style="width:1.5ex">
</div>
<div id="kampala-uganda-tourist-sites-caption" class="caption-frame">
<p>Figure: Tourist sites identified as Points of Interest in Open Street
Map.</p>
</div>
</div>
<p>We have the POIs that are associated with tourist places in a
geodataframe. To work with them in a machine learning algorithm, it will
be easier to conveert them to a <code>pandas</code> DataFrame. This
means dealing with the geometry. If we examine the POIs.</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tourist_places.loc[<span class="st">&quot;node&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> tourist_places[<span class="st">&quot;geometry&quot;</span>][<span class="st">&quot;way&quot;</span>]:</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;latitude: </span><span class="sc">{latitude}</span><span class="st">, longitude: </span><span class="sc">{longitude}</span><span class="st">&quot;</span>.<span class="bu">format</span>(latitude<span class="op">=</span>i.centroid.y, longitude<span class="op">=</span>i.centroid.x))</span></code></pre></div>
<h2 id="matching-openstreetmap-and-nmis-data">Matching OpenStreetMap and
NMIS Data</h2>
<div style="text-align:right">
<span class="editsection-bracket" style="">[</span><span
class="editsection"
style=""><a href="https://github.com/lawrennd/snippets/edit/main/_data-science/includes/open-street-map-nigeria-nmis-exercise.md" target="_blank" onclick="ga('send', 'event', 'Edit Page', 'Edit', 'https://github.com/lawrennd/snippets/edit/main/_data-science/includes/open-street-map-nigeria-nmis-exercise.md', 13);">edit</a></span><span class="editsection-bracket" style="">]</span>
</div>
<p>In this exercise you will download the location of health centres
from OpenStreetMap in Lagos and map them to the health centres you’ve
already viewed in the NMIS data. This is a data validation exercise.</p>
<h3 id="exercise-3">Exercise 3</h3>
<p>The latitude and longitude of Lagos in Nigeria are as follows:</p>
<pre><code>place_name = &quot;Lagos, Nigeria&quot;

latitude = 6.5244
longitude = 3.3792</code></pre>
<p>In OpenStreetMap the key for a health center is
<code>key:healthcare</code>. Download the POIs on OpenStreetMap that are
listed as health centres and match them to POIs in the OpenStreetMap
data to the health centres we find in the Nigerian NMIS data
(<code>pods.datasets.nigeria_nmis</code>).</p>
<p>You may use the distance between the centroid for the match, but you
should also consider any additional checks you might wish to
perform.</p>
<p>Ensure your code is reusable, making it easy to integrate any
necessary human feedback as required.</p>
<p>You may need to vary the size of the bounding box to get matches. Use
your reusable code to ensure that you obtain at least five matches
between the data set (by increasing bounding box size).</p>
<p>Now further demonstrate the reuse by performing the same analysis for
Abuja.</p>
<pre><code>place_name = &quot;Abuja, Nigeria&quot;

latitude = 9.05785 
longitude = 7.49508</code></pre>
<h2 id="thanks">Thanks!</h2>
<p>For more information on these subjects and more you might want to
check the following resources.</p>
<ul>
<li>twitter: <a href="https://twitter.com/lawrennd">@lawrennd</a></li>
<li>podcast: <a href="http://thetalkingmachines.com">The Talking
Machines</a></li>
<li>newspaper: <a
href="http://www.theguardian.com/profile/neil-lawrence">Guardian Profile
Page</a></li>
<li>blog: <a
href="http://inverseprobability.com/blog.html">http://inverseprobability.com</a></li>
</ul>
<h1 class="unnumbered" id="references">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent"
role="list">
<div id="ref-Hirst-supporting21" class="csl-entry" role="listitem">
Hirst, T., 2021. <a
href="https://blog.ouseful.info/2021/11/03/supporting-playful-exploration-of-data-clustering-and-classification/">Supporting
playful exploration of data clustering and classification using
datadraw</a>.
</div>
<div id="ref-Hirst-interactive16" class="csl-entry" role="listitem">
Hirst, T., 2016. <a
href="https://blog.ouseful.info/2016/12/29/simple-view-controls-for-pandas-dataframes-using-ipython-widgets/">Simple
interactive view controls for pandas DataFrames using IPython widgets in
jupyter notebooks</a>.
</div>
</div>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>For example the <a
href="https://blog.openstreetmap.org/2010/01/14/haiti-openstreetmap-response/">OpenStreetMap
response to the 2010 Haiti Earthquake</a>.<a href="#fnref1"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For example this <a
href="https://www.unglobalpulse.org/project/measuring-poverty-with-machine-roof-counting/">UN
Global Pulse</a> project which measures roof material as a proxy for
poverty levels.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Many of the most interesting blog posts are hard to find
on Google because it’s become dominate by sites that are well optimized
for search engines. Even when useful, I find the click-bait titles of
the posts that surface on sites like towardsdatascience off-putting:
“Four ways of Plotting Data you Must Know About” or “Eight Things Every
Data Scientist Sould Know” or “Do you remember this ggplot command? You
won’t believe what it looks like today!” or “Five Other Cambridge Data
Scientists are Currently Using this Trick to Understand their Data”. OK
… I made the last two up. Well I made them all up, but I’ve not seen
ones like the last two … but I have seen snippets of useful information
masquerading under the other titles on medium/towardsdatascience, but
the overall posts are usually quite vacuous.<a href="#fnref3"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>

